import{r as s,j as t,k as n,o as E,l as T}from"./index-DgmVCOGL.js";function F({update:r,id:a}){const[o,d]=s.useState({title:"",is_public:!1,created_at:""}),h=async()=>{const{error:c}=await n.from("chapter").insert({proyect_id:a,title:o.title,is_public:o.is_public,created_at:o.created_at});if(c){console.error("Insert error:",c);return}d({title:"",is_public:!1,created_at:""}),r()};return t.jsxs("div",{className:"form",children:[t.jsx("h3",{children:"Agregar Capitulo"}),t.jsx("label",{htmlFor:"date",children:"Fecha"}),t.jsx("input",{type:"date",id:"date",value:o.created_at,onChange:c=>d({...o,created_at:c.target.value})}),t.jsx("input",{type:"text",placeholder:"Título",value:o.title,onChange:c=>d({...o,title:c.target.value})}),t.jsxs("label",{children:[t.jsx("input",{type:"checkbox",checked:o.is_public,onChange:c=>d({...o,is_public:c.target.checked})}),"Público"]}),t.jsx("button",{onClick:h,children:"Enviar"})]})}function I(){const[r,a]=s.useState();let{id:o}=E();const d=T(),[h,c]=s.useState(null),[f,b]=s.useState([]),[l,m]=s.useState(-1),[p,x]=s.useState([]),[j,_]=s.useState([]),g=async()=>{const{data:e,error:i}=await n.from("proyect").select("*").eq("id",o).single();i&&console.error(i),e&&a(e)},v=async()=>{let e="";if(h){const u=h.name.split(".").pop();e=`proyects/${`${crypto.randomUUID()}.${u}`}`;const{error:y}=await n.storage.from("content").upload(e,h);if(y){console.error("Upload error:",y);return}}const{error:i}=await n.from("proyect").update({title:r?.title,description:r?.description,github:r?.github,photo_url:r?.photo_url,created_at:r?.created_at,is_public:r?.is_public}).eq("id",r?.id);if(i){console.error("Insert error:",i);return}g()},C=async()=>{const{data:e,error:i}=await n.from("tech").select("id, technology, tech_type(id, type)");i&&console.error(i),e&&b(e)},k=async()=>{const{data:e,error:i}=await n.from("tech_proyect").select("tech").eq("proyect",r?.id);i&&console.error(i),e&&x(e.map(u=>u.tech))},P=async()=>{const{data:e,error:i}=await n.from("chapter").select("*").eq("proyect_id",r?.id);i&&console.error(i),e&&_(e)},w=async e=>{const{data:i,error:u}=await n.from("tech_proyect").insert({tech:e,proyect:r?.id});if(u)throw Error(u.message)};return s.useEffect(()=>{g(),C()},[]),s.useEffect(()=>{r&&(k(),P())},[r]),t.jsxs("div",{className:"admin-proyect",children:[t.jsxs("h1",{children:["Proyecto id: ",r?.id]}),t.jsxs("section",{style:{margin:20,padding:20,border:"1px solid black",borderRadius:10,display:"flex",flexDirection:"column",gap:10},children:[t.jsx("label",{htmlFor:"title",children:"Titulo:"}),t.jsx("input",{type:"text",value:r?.title,onChange:e=>{r&&a({...r,title:e.target.value})}}),t.jsx("label",{htmlFor:"description",children:"Descripción:"}),t.jsx("textarea",{value:r?.description,onChange:e=>{r&&a({...r,description:e.target.value})}}),t.jsx("label",{htmlFor:"github",children:"Github Link:"}),t.jsx("input",{type:"text",value:r?.github,onChange:e=>{r&&a({...r,github:e.target.value})}}),t.jsx("label",{htmlFor:"created_at",children:"Creado:"}),t.jsx("input",{type:"date",value:r?.created_at,onChange:e=>{r&&a({...r,created_at:e.target.value})}}),t.jsx("img",{src:r?.photo_url||"/placeholder.png",alt:r?.title,style:{width:"268px",height:"268px",objectFit:"cover",borderRadius:"8px",overflow:"hidden"}}),t.jsx("input",{type:"file",accept:"image/*",onChange:e=>c(e.target.files?.[0]??null)}),t.jsx("label",{htmlFor:"title",children:"Es publico:"}),t.jsx("input",{type:"checkbox",checked:r?.is_public,onChange:()=>{r&&a({...r,is_public:!r.is_public})}}),t.jsx("button",{onClick:v,children:"Guardar"})]}),t.jsxs("section",{style:{margin:20,padding:20,border:"1px solid black",borderRadius:10},children:[t.jsx("h2",{children:"Capitulos"}),j.map(e=>t.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center"},children:[t.jsx("h3",{children:e.title}),t.jsxs("p",{children:["(",e.created_at,")"]})]},e.id)),t.jsx(F,{update:()=>{},id:r?r.id:-1})]}),t.jsxs("section",{style:{margin:20,padding:20,border:"1px solid black",borderRadius:10},children:[t.jsx("h2",{children:"Tecnologias"}),t.jsxs("select",{value:l,onChange:e=>m(Number(e.target.value)),children:[t.jsx("option",{value:-1,children:"Seleccione una opción"},-1),f.map(e=>t.jsx("option",{value:e.id,children:e.technology},e.id))]}),t.jsx("button",{onClick:()=>{if(l==-1){console.log(l);return}if(p.includes(l)){console.log(l),console.log(p);return}w(l),x(e=>[...e,l])},children:"Agregar"}),p.map(e=>t.jsx("p",{children:f.find(i=>i.id===e)?.technology},e))]}),t.jsx("button",{onClick:()=>{d(-1)},children:"Volver"})]})}export{I as default};
